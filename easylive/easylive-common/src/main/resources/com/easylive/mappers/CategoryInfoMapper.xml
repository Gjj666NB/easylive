<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.easylive.mappers.CategoryInfoMapper">
    <!--实体映射-->
    <resultMap id="base_result_map" type="com.easylive.entity.po.CategoryInfo">
        <!-- 分类id -->
        <id column="category_id" property="categoryId"/>
        <!-- 分类编码 -->
        <result column="category_code" property="categoryCode"/>
        <!-- 分类名称 -->
        <result column="category_name" property="categoryName"/>
        <!-- 父级分类id -->
        <result column="p_category_id" property="pCategoryId"/>
        <!-- 图标 -->
        <result column="icon" property="icon"/>
        <!-- 背景图 -->
        <result column="background" property="background"/>
        <!-- 排序字段 -->
        <result column="sort" property="sort"/>
    </resultMap>

    <!--通用结果查询列-->
    <sql id="base_column_list">
        c
        .
        category_id
        , c.category_code, c.category_name, c.p_category_id, c.icon, c.background, c.sort
    </sql>

    <!--基础查询条件-->
    <sql id="base_query_condition">
        <if test="query.categoryId != null">
            and c.category_id = #{query.categoryId}
        </if>
        <if test="query.categoryCode != null and query.categoryCode != ''">
            and c.category_code = #{query.categoryCode}
        </if>
        <if test="query.categoryName != null and query.categoryName != ''">
            and c.category_name = #{query.categoryName}
        </if>
        <if test="query.pCategoryId != null">
            and c.p_category_id = #{query.pCategoryId}
        </if>
        <if test="query.icon != null and query.icon != ''">
            and c.icon = #{query.icon}
        </if>
        <if test="query.background != null and query.background != ''">
            and c.background = #{query.background}
        </if>
        <if test="query.sort != null">
            and c.sort = #{query.sort}
        </if>
    </sql>

    <!--扩展查询条件-->
    <sql id="base_query_condition_extend">
        <if test="query.categoryCodeFuzzy != null and query.categoryCodeFuzzy != ''">
            and c.category_code like concat('%', #{query.categoryCodeFuzzy}, '%')
        </if>
        <if test="query.categoryNameFuzzy != null and query.categoryNameFuzzy != ''">
            and c.category_name like concat('%', #{query.categoryNameFuzzy}, '%')
        </if>
        <if test="query.iconFuzzy != null and query.iconFuzzy != ''">
            and c.icon like concat('%', #{query.iconFuzzy}, '%')
        </if>
        <if test="query.backgroundFuzzy != null and query.backgroundFuzzy != ''">
            and c.background like concat('%', #{query.backgroundFuzzy}, '%')
        </if>
        <if test="query.pCategoryIdOrCategoryId != null">
            and c.category_id = #{query.pCategoryIdOrCategoryId} or c.p_category_id = #{query.pCategoryIdOrCategoryId}
        </if>
    </sql>

    <!--通用查询条件-->
    <sql id="query_condition">
        <where>
            <include refid="base_query_condition"/>
            <include refid="base_query_condition_extend"/>
        </where>
    </sql>

    <!--查询列表-->
    <select id="selectList" resultMap="base_result_map">
        select
        <include refid="base_column_list"/>
        from category_info c
        <include refid="query_condition"/>
        <if test="query.orderBy != null">
            order by ${query.orderBy}
        </if>
        <if test="query.simplePage != null">
            limit #{query.simplePage.start}, #{query.simplePage.end}
        </if>
    </select>

    <!--查询数量-->
    <select id="selectCount" resultType="java.lang.Integer">
        select count(1) from category_info c
        <include refid="query_condition"/>
    </select>

    <!--单条插入（匹配有值的字段）-->
    <insert id="insert" parameterType="com.easylive.entity.po.CategoryInfo">
        <selectKey keyProperty="bean.categoryId" resultType="Integer" order="AFTER">
            select last_insert_id()
        </selectKey>
        insert into category_info
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="bean.categoryId != null">
                category_id,
            </if>
            <if test="bean.categoryCode != null">
                category_code,
            </if>
            <if test="bean.categoryName != null">
                category_name,
            </if>
            <if test="bean.pCategoryId != null">
                p_category_id,
            </if>
            <if test="bean.icon != null">
                icon,
            </if>
            <if test="bean.background != null">
                background,
            </if>
            <if test="bean.sort != null">
                sort,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="bean.categoryId != null">
                #{bean.categoryId},
            </if>
            <if test="bean.categoryCode != null">
                #{bean.categoryCode},
            </if>
            <if test="bean.categoryName != null">
                #{bean.categoryName},
            </if>
            <if test="bean.pCategoryId != null">
                #{bean.pCategoryId},
            </if>
            <if test="bean.icon != null">
                #{bean.icon},
            </if>
            <if test="bean.background != null">
                #{bean.background},
            </if>
            <if test="bean.sort != null">
                #{bean.sort},
            </if>
        </trim>
    </insert>

    <!--插入或更新（匹配有值的字段）-->
    <insert id="insertOrUpdate" parameterType="com.easylive.entity.po.CategoryInfo">
        insert into category_info
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="bean.categoryId != null">
                category_id,
            </if>
            <if test="bean.categoryCode != null">
                category_code,
            </if>
            <if test="bean.categoryName != null">
                category_name,
            </if>
            <if test="bean.pCategoryId != null">
                p_category_id,
            </if>
            <if test="bean.icon != null">
                icon,
            </if>
            <if test="bean.background != null">
                background,
            </if>
            <if test="bean.sort != null">
                sort,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="bean.categoryId != null">
                #{bean.categoryId},
            </if>
            <if test="bean.categoryCode != null">
                #{bean.categoryCode},
            </if>
            <if test="bean.categoryName != null">
                #{bean.categoryName},
            </if>
            <if test="bean.pCategoryId != null">
                #{bean.pCategoryId},
            </if>
            <if test="bean.icon != null">
                #{bean.icon},
            </if>
            <if test="bean.background != null">
                #{bean.background},
            </if>
            <if test="bean.sort != null">
                #{bean.sort},
            </if>
        </trim>
        on duplicate key update
        <trim prefix="" suffix="" suffixOverrides=",">
            <if test="bean.categoryName != null">
                category_name = values(category_name),
            </if>
            <if test="bean.pCategoryId != null">
                p_category_id = values(p_category_id),
            </if>
            <if test="bean.icon != null">
                icon = values(icon),
            </if>
            <if test="bean.background != null">
                background = values(background),
            </if>
            <if test="bean.sort != null">
                sort = values(sort),
            </if>
        </trim>
    </insert>

    <!--批量添加-->
    <insert id="insertBatch" parameterType="com.easylive.entity.po.CategoryInfo">
        insert into category_info (category_id, category_code, category_name, p_category_id, icon, background, sort)
        values
        <foreach collection="list" item="item" separator=",">
            (#{item.categoryId}, #{item.categoryCode}, #{item.categoryName}, #{item.pCategoryId}, #{item.icon},
            #{item.background}, #{item.sort})
        </foreach>
    </insert>

    <!--批量添加或更新-->
    <insert id="insertOrUpdateBatch" parameterType="com.easylive.entity.po.CategoryInfo">
        insert into category_info (category_id, category_code, category_name, p_category_id, icon, background, sort)
        values
        <foreach collection="list" item="item" separator=",">
            (#{item.categoryId}, #{item.categoryCode}, #{item.categoryName}, #{item.pCategoryId}, #{item.icon},
            #{item.background}, #{item.sort})
        </foreach>
        on duplicate key update
        category_id = values(category_id), category_code = values(category_code), category_name = values(category_name),
        p_category_id = values(p_category_id), icon = values(icon), background = values(background), sort = values(sort)
    </insert>

    <!--根据CategoryId查询-->
    <select id="selectByCategoryId" resultMap="base_result_map">
        select
        <include refid="base_column_list"/>
        from category_info c where c.category_id = #{categoryId}
    </select>

    <!--根据CategoryId更新-->
    <update id="updateByCategoryId" parameterType="com.easylive.entity.po.CategoryInfo">
        update category_info
        <set>
            <if test="bean.categoryId != null">
                category_id = #{bean.categoryId},
            </if>
            <if test="bean.categoryCode != null">
                category_code = #{bean.categoryCode},
            </if>
            <if test="bean.categoryName != null">
                category_name = #{bean.categoryName},
            </if>
            <if test="bean.pCategoryId != null">
                p_category_id = #{bean.pCategoryId},
            </if>
            <if test="bean.icon != null">
                icon = #{bean.icon},
            </if>
            <if test="bean.background != null">
                background = #{bean.background},
            </if>
            <if test="bean.sort != null">
                sort = #{bean.sort},
            </if>
        </set>
        where category_id = #{categoryId}
    </update>

    <!--根据CategoryId删除-->
    <delete id="deleteByCategoryId">
        delete
        from category_info
        where category_id = #{categoryId}
    </delete>

    <!--根据CategoryCode查询-->
    <select id="selectByCategoryCode" resultMap="base_result_map">
        select
        <include refid="base_column_list"/>
        from category_info c where c.category_code = #{categoryCode}
    </select>

    <!--根据CategoryCode更新-->
    <update id="updateByCategoryCode" parameterType="com.easylive.entity.po.CategoryInfo">
        update category_info
        <set>
            <if test="bean.categoryId != null">
                category_id = #{bean.categoryId},
            </if>
            <if test="bean.categoryCode != null">
                category_code = #{bean.categoryCode},
            </if>
            <if test="bean.categoryName != null">
                category_name = #{bean.categoryName},
            </if>
            <if test="bean.pCategoryId != null">
                p_category_id = #{bean.pCategoryId},
            </if>
            <if test="bean.icon != null">
                icon = #{bean.icon},
            </if>
            <if test="bean.background != null">
                background = #{bean.background},
            </if>
            <if test="bean.sort != null">
                sort = #{bean.sort},
            </if>
        </set>
        where category_code = #{categoryCode}
    </update>

    <!--根据CategoryCode删除-->
    <delete id="deleteByCategoryCode">
        delete
        from category_info
        where category_code = #{categoryCode}
    </delete>

    <!--根据query条件修改-->
    <update id="updateByQuery">
        update category_info c
        <set>
            <if test="bean.categoryId != null">
                c.category_id = #{bean.categoryId},
            </if>
            <if test="bean.categoryCode != null">
                c.category_code = #{bean.categoryCode},
            </if>
            <if test="bean.categoryName != null">
                c.category_name = #{bean.categoryName},
            </if>
            <if test="bean.pCategoryId != null">
                c.p_category_id = #{bean.pCategoryId},
            </if>
            <if test="bean.icon != null">
                c.icon = #{bean.icon},
            </if>
            <if test="bean.background != null">
                c.background = #{bean.background},
            </if>
            <if test="bean.sort != null">
                c.sort = #{bean.sort},
            </if>
        </set>
        <include refid="query_condition"/>
    </update>

    <!--根据query条件删除-->
    <delete id="deleteByQuery">
        delete from category_info c
        <include refid="query_condition"/>
    </delete>

    <update id="updateSortBatch">
        <foreach item="item" collection="categoryInfoList" separator=";">
            update category_info set sort = #{item.sort} where category_id = #{item.categoryId} and p_category_id =
            #{item.pCategoryId}
        </foreach>
    </update>

    <select id="selectMaxSort" resultType="java.lang.Integer">
        select ifnull(max(sort), 0)
        from category_info
        where p_category_id = #{pCategoryId}
    </select>
</mapper>